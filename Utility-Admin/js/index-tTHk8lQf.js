import{j as X,h as H}from"./index-DLU_U3ea.js";import{u as J,g as Z}from"./useFormValue-Bnx1_Y6g.js";import{T as z}from"./index-Bddo_vMy.js";import{n as K,aP as q,V as Q,f as Y,v as f,E as ee,o as T,J as $,K as a,q as ae,O as e,am as i,k as t,a as S,a4 as M,bd as P,b$ as te,aV as ne,c0 as oe,c1 as le,bK as se,bc as N,aU as E,b1 as ue,F as m,an as re,bG as de,bg as ie,c2 as pe,bH as _e,R as ce,G as me,X as B,bZ as fe,aW as ve,aX as ge,aI as be,as as ye,b_ as xe,bF as ke}from"./.pnpm-DTVa1Nkx.js";import"./Table-CeRq0Wkw.js";const we={"text-end":""},Ie=K({__name:"SetDeptDrawer",props:q({data:{type:Object,default:()=>({})},treeData:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!1}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:q(["reload"],["update:open"]),setup(v,{emit:d}){const s=v,p=d,_=Q(v,"open"),C=Y(()=>s.isEdit?"编辑部门":"新增部门"),g=f(),{form:n,resetFormValue:k,setFormValue:O}=J({name:"",parentId:null,order:0,principal:"",status:1,remark:""}),V=async()=>{await g.value.validate(),S.success("操作成功"),p("reload"),w()},w=()=>{k(),_.value=!1};return ee(()=>_.value,()=>{_.value&&s.isEdit&&O(s.data)}),(h,l)=>{const I=M,u=P,c=te,r=ne,b=oe,y=le,R=se,U=N,D=E,F=ue;return T(),$(F,{open:_.value,"onUpdate:open":l[6]||(l[6]=o=>_.value=o),title:t(C),placement:"right",onClose:w},{footer:a(()=>[ae("div",we,[e(D,{type:"primary",onClick:V},{default:a(()=>[i("确定")]),_:1}),e(D,{onClick:w},{default:a(()=>[i("取消")]),_:1})])]),default:a(()=>[e(U,{ref_key:"formRef",ref:g,model:t(n),layout:"vertical"},{default:a(()=>[e(u,{label:"部门名称",name:"name",required:""},{default:a(()=>[e(I,{value:t(n).name,"onUpdate:value":l[0]||(l[0]=o=>t(n).name=o),placeholder:"请输入部门名称",allowClear:""},null,8,["value"])]),_:1}),e(u,{label:"上级部门",name:"parentId",required:!v.isEdit||!!t(n).parentId},{default:a(()=>[e(c,{value:t(n).parentId,"onUpdate:value":l[1]||(l[1]=o=>t(n).parentId=o),placeholder:"请选择上级部门","allow-clear":"","tree-data":v.treeData,"tree-default-expand-all":"","tree-node-filter-prop":"name","field-names":{children:"children",label:"name",value:"id"}},null,8,["value","tree-data"])]),_:1},8,["required"]),e(u,{label:"负责人",name:"principal",required:""},{default:a(()=>[e(I,{value:t(n).principal,"onUpdate:value":l[2]||(l[2]=o=>t(n).principal=o),placeholder:"请输入负责人",allowClear:""},null,8,["value"])]),_:1}),e(u,{label:"排序",name:"order",required:""},{default:a(()=>[e(r,{value:t(n).order,"onUpdate:value":l[3]||(l[3]=o=>t(n).order=o),min:1},null,8,["value"])]),_:1}),e(u,{label:"状态",name:"status",required:""},{default:a(()=>[e(y,{value:t(n).status,"onUpdate:value":l[4]||(l[4]=o=>t(n).status=o),"button-style":"solid"},{default:a(()=>[e(b,{value:1},{default:a(()=>[i("启用")]),_:1}),e(b,{value:0},{default:a(()=>[i("停用")]),_:1})]),_:1},8,["value"])]),_:1}),e(u,{label:"备注",name:"remark"},{default:a(()=>[e(R,{value:t(n).remark,"onUpdate:value":l[5]||(l[5]=o=>t(n).remark=o),placeholder:"请输入备注",allowClear:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),Re=(v,d)=>[{title:"部门名称",dataIndex:"name",fixed:"left"},{title:"排序",dataIndex:"order",align:"center",width:80},{title:"状态",dataIndex:"status",align:"center",customRender:({text:s})=>m(re,{color:s?"green":"red"},()=>s?"启用":"停用")},{title:"创建时间",dataIndex:"createTime",align:"center"},{title:"备注",dataIndex:"remark",align:"center",width:600},{title:"操作",dataIndex:"action",align:"center",width:120,fixed:"right",customRender:({record:s})=>m("div",{},[m(E,{type:"link",icon:m(de),onClick:()=>v(s)}),m(ie,{type:"vertical"}),m(pe,{title:"确定删除吗？",overlayStyle:{width:"200px"},onConfirm:()=>d(s)},()=>m(E,{type:"link",danger:!0,icon:m(_e)}))])}],Oe=K({__name:"index",setup(v){const d=f(!1),s=f(!1),p=ce({name:"",status:null}),_=f(),C=f(),g=f([]),n=f(!1),k=f([]),w=Re(c=>{d.value=!0,s.value=!0,C.value=c},c=>{S.success("假装删除成功："+c.name),u()}),h=()=>{s.value=!1,d.value=!0},l=async()=>{u(p)},I=()=>{_.value.resetFields(),u()},u=async c=>{var b,y;n.value=!0;const r=await Z(c);k.value=X({list:r.data,orderFiled:"order"}),g.value.push((y=(b=k.value)==null?void 0:b[0])==null?void 0:y.id),n.value=!1};return me(()=>{u()}),(c,r)=>{const b=M,y=P,R=fe,U=ve,D=ge,F=be,o=E,j=ye,A=xe,G=N,L=ke,W=H;return T(),$(W,{dense:""},{header:a(()=>[e(G,{class:"search-form",ref_key:"formRef",ref:_,"label-col":{span:6},model:t(p)},{default:a(()=>[e(A,{gutter:36},{default:a(()=>[e(R,{span:8},{default:a(()=>[e(y,{label:"部门名称",name:"name"},{default:a(()=>[e(b,{value:t(p).name,"onUpdate:value":r[0]||(r[0]=x=>t(p).name=x),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(R,{span:8},{default:a(()=>[e(y,{label:"状态",name:"status"},{default:a(()=>[e(D,{value:t(p).status,"onUpdate:value":r[1]||(r[1]=x=>t(p).status=x),placeholder:"请选择"},{default:a(()=>[e(U,{value:0},{default:a(()=>[i("停用")]),_:1}),e(U,{value:1},{default:a(()=>[i("启用")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(R,{span:8,"text-end":""},{default:a(()=>[e(o,{onClick:I},{icon:a(()=>[e(F)]),default:a(()=>[i(" 重置 ")]),_:1}),e(o,{type:"primary",ghost:"",onClick:l},{icon:a(()=>[e(j)]),default:a(()=>[i(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),default:a(()=>[e(t(z),{columns:t(w),"data-source":t(k),bordered:"",title:"部门管理",rowKey:"id",loading:t(n),scroll:{x:1300},sticky:"",pagination:!1,expandedRowKeys:t(g),"onUpdate:expandedRowKeys":r[2]||(r[2]=x=>B(g)?g.value=x:null),onReload:I},{"pre-tools":a(()=>[e(o,{type:"primary",onClick:h},{icon:a(()=>[e(L)]),default:a(()=>[i(" 新增 ")]),_:1})]),_:1},8,["columns","data-source","loading","expandedRowKeys"]),e(Ie,{open:t(d),"onUpdate:open":r[3]||(r[3]=x=>B(d)?d.value=x:null),isEdit:t(s),data:t(C),treeData:t(k),onReload:u},null,8,["open","isEdit","data","treeData"])]),_:1})}}});export{Oe as default};

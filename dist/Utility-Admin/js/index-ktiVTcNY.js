import{h as Y}from"./index-DtsDTyql.js";import{u as ee,a as te,b as ae}from"./useFormValue-DCVGUfv1.js";import{T as oe}from"./index-C3BUy6pF.js";import{n as P,aP as $,V as ne,f as le,v as p,E as se,G as q,o as L,J as W,K as t,O as e,k as a,b$ as z,am as m,a9 as V,a as A,a4 as G,bd as H,an as X,c0 as ue,c1 as re,bK as de,bc as j,au as ie,F as f,aU as K,bG as ce,bg as _e,c2 as pe,bH as me,R as B,X as D,bZ as fe,aW as ve,aX as ge,aI as ye,as as be,b_ as we,bF as ke}from"./.pnpm-DTVa1Nkx.js";import"./Table-COXs7vey.js";const xe=P({__name:"SetRoleModal",props:$({isEdit:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},{open:{type:Boolean},openModifiers:{}}),emits:$(["reload"],["update:open"]),setup(y,{emit:c}){const s=y,u=ne(y,"open"),k=le(()=>s.isEdit?"编辑角色":"新增角色"),x=c,g=p(),{form:n,resetFormValue:C,setFormValue:i}=ee({roleName:"",roleCode:"",remark:"",menus:[],status:0}),S=p([]),T=async()=>{await g.value.validate(),A.success("操作成功"),x("reload"),R()},R=()=>{C(),u.value=!1},I=async()=>{const N=await te();S.value=N.data};return se(()=>u.value,()=>{u.value&&s.isEdit&&i(s.data)}),q(()=>{I()}),(N,l)=>{const v=G,r=H,d=X,O=z,b=ue,w=re,h=de,U=j,E=ie;return L(),W(E,{open:u.value,"onUpdate:open":l[5]||(l[5]=o=>u.value=o),title:a(k),width:"550px",destroyOnClose:"",onOk:T,onCancel:R},{default:t(()=>[e(U,{class:"my-6",ref_key:"formRef",ref:g,model:a(n),layout:"horizontal","label-col":{span:4}},{default:t(()=>[e(r,{label:"角色名称",name:"roleName",required:""},{default:t(()=>[e(v,{value:a(n).roleName,"onUpdate:value":l[0]||(l[0]=o=>a(n).roleName=o),placeholder:"请输入角色名称",allowClear:""},null,8,["value"])]),_:1}),e(r,{label:"角色标识",name:"roleCode",required:""},{default:t(()=>[e(v,{value:a(n).roleCode,"onUpdate:value":l[1]||(l[1]=o=>a(n).roleCode=o),placeholder:"请输入角色标识",allowClear:""},null,8,["value"])]),_:1}),e(r,{label:"菜单分配",name:"menus",required:""},{default:t(()=>[e(O,{value:a(n).menus,"onUpdate:value":l[2]||(l[2]=o=>a(n).menus=o),placeholder:"请选择菜单","allow-clear":"","tree-data":a(S),"tree-node-filter-prop":"title","tree-checkable":"",showCheckedStrategy:a(z).SHOW_PARENT,"field-names":{children:"children",label:"title",value:"id"}},{title:t(({title:o})=>[m(V(o),1)]),tagRender:t(({label:o,closable:M,onClose:F})=>[e(d,{closable:M,color:"blue",onClose:F},{default:t(()=>[m(V(o)+"   ",1)]),_:2},1032,["closable","onClose"])]),_:1},8,["value","tree-data","showCheckedStrategy"])]),_:1}),e(r,{label:"状态",name:"status",required:""},{default:t(()=>[e(w,{value:a(n).status,"onUpdate:value":l[3]||(l[3]=o=>a(n).status=o),"button-style":"solid"},{default:t(()=>[e(b,{value:1},{default:t(()=>[m("启用")]),_:1}),e(b,{value:0},{default:t(()=>[m("停用")]),_:1})]),_:1},8,["value"])]),_:1}),e(r,{label:"备注",name:"remark"},{default:t(()=>[e(h,{value:a(n).remark,"onUpdate:value":l[4]||(l[4]=o=>a(n).remark=o),placeholder:"请输入备注","auto-size":{minRows:3,maxRows:5}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),Ce=(y,c)=>[{title:"角色名称",dataIndex:"roleName"},{title:"角色标识",dataIndex:"roleCode",align:"center",width:150},{title:"状态",dataIndex:"status",align:"center",width:80,customRender:({text:s})=>f(X,{color:s?"green":"red"},()=>s?"启用":"停用")},{title:"创建时间",dataIndex:"createTime",align:"center"},{title:"备注",dataIndex:"remark",align:"center",width:600},{title:"操作",dataIndex:"action",align:"center",width:120,customRender:({record:s})=>f("div",{},[f(K,{type:"link",icon:f(ce),onClick:()=>y(s)}),f(_e,{type:"vertical"}),f(pe,{title:"确定删除吗？",overlayStyle:{width:"200px"},onConfirm:()=>c(s)},()=>f(K,{type:"link",danger:!0,icon:f(me)}))])}],Oe=P({__name:"index",setup(y){const c=p(!1),s=p(!1),u=B({roleName:"",status:null}),k=p(),x=p(),g=p([]),n=p(!1),C=p([]),i=B({pageSize:10,pageNum:1,total:0}),R=Ce(r=>{c.value=!0,s.value=!0,x.value=r},r=>{A.success("假装删除成功："+r.name),v()}),I=()=>{s.value=!1,c.value=!0},N=async()=>{v({...u,...i})},l=()=>{k.value.resetFields(),i.pageNum=1,i.pageSize=10,i.total=0,v(i)},v=async r=>{n.value=!0;const d=await ae(r);C.value=d.data.rows,n.value=!1};return q(()=>{v()}),(r,d)=>{const O=G,b=H,w=fe,h=ve,U=ge,E=ye,o=K,M=be,F=we,J=j,Z=ke,Q=Y;return L(),W(Q,{dense:""},{header:t(()=>[e(J,{class:"search-form",ref_key:"formRef",ref:k,"label-col":{span:6},model:a(u)},{default:t(()=>[e(F,{gutter:36},{default:t(()=>[e(w,{span:8},{default:t(()=>[e(b,{label:"角色名称",name:"roleName"},{default:t(()=>[e(O,{value:a(u).roleName,"onUpdate:value":d[0]||(d[0]=_=>a(u).roleName=_),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(w,{span:8},{default:t(()=>[e(b,{label:"状态",name:"status"},{default:t(()=>[e(U,{value:a(u).status,"onUpdate:value":d[1]||(d[1]=_=>a(u).status=_),placeholder:"请选择"},{default:t(()=>[e(h,{value:0},{default:t(()=>[m("停用")]),_:1}),e(h,{value:1},{default:t(()=>[m("启用")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(w,{span:8,"text-end":""},{default:t(()=>[e(o,{onClick:l},{icon:t(()=>[e(E)]),default:t(()=>[m(" 重置 ")]),_:1}),e(o,{type:"primary",ghost:"",onClick:N},{icon:t(()=>[e(M)]),default:t(()=>[m(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),default:t(()=>[e(a(oe),{columns:a(R),"data-source":a(C),bordered:"",title:"角色管理",rowKey:"id",loading:a(n),sticky:"",expandedRowKeys:a(g),"onUpdate:expandedRowKeys":d[2]||(d[2]=_=>D(g)?g.value=_:null),pagination:{current:a(i).pageNum,pageSize:a(i).pageSize,total:a(i).total,showTotal:_=>`共 ${_} 条`},onReload:l},{"pre-tools":t(()=>[e(o,{type:"primary",onClick:I},{icon:t(()=>[e(Z)]),default:t(()=>[m(" 新增 ")]),_:1})]),_:1},8,["columns","data-source","loading","expandedRowKeys","pagination"]),e(xe,{open:a(c),"onUpdate:open":d[3]||(d[3]=_=>D(c)?c.value=_:null),isEdit:a(s),data:a(x)},null,8,["open","isEdit","data"])]),_:1})}}});export{Oe as default};

import{g as H,u as de,c as re,d as ie}from"./useFormValue-B8ERu0O9.js";import{j as J}from"./index-D4uYTirw.js";import{n as z,v as d,G as P,o as E,p as j,q as F,O as e,k as a,X as N,K as t,l as ce,c5 as pe,aC as _e,bg as W,c6 as me,am as m,c7 as fe,al as ve,ag as ge,aP as G,V as ye,f as xe,E as be,J as X,b1 as we,Y as he,a9 as ke,Z as Ce,a as V,a4 as Y,bd as Q,c0 as Ie,c1 as Ue,b$ as Re,aW as ee,aX as te,bc as ae,aU as B,F as h,an as Z,bG as De,c2 as Se,bH as ne,R as A,au as $e,aw as Ke,bZ as Oe,aI as Ee,as as Fe,b_ as Te,bF as qe}from"./.pnpm-DTVa1Nkx.js";import{T as Ne}from"./index-BE-k9t3E.js";import"./Table-BIVvGnEV.js";const Be={class:"bg-[var(--common-bg-color)]"},Le={flex:"","items-center":"","p-3":""},Me={class:"p-3"},Ve=z({__name:"DeptTree",emits:["change"],setup(R,{emit:g}){const o=g,w=d(""),p=()=>{b({name:w.value})},k=({key:y})=>{y==="expand"?l.value=i.value:y==="un-expand"&&(l.value=[])},C=d(!1),i=d([]),l=d([]),D=d([]),S=d([]),$=y=>{o("change",y[0])},b=async y=>{C.value=!0;const c=await H(y);S.value=J({list:c.data,orderFiled:"order"}),l.value=c.data.filter(x=>{var r;return(r=x==null?void 0:x.children)==null?void 0:r.length}).map(x=>x.id),i.value=ce.cloneDeep(l.value),C.value=!1};return P(()=>{b()}),(y,c)=>{const x=pe,r=fe,n=ve,I=ge,f=_e,v=W,_=me;return E(),j("div",Be,[F("div",Le,[e(x,{value:a(w),"onUpdate:value":c[0]||(c[0]=u=>N(w)?w.value=u:null),placeholder:"搜索部门","allow-clear":"",onSearch:p},null,8,["value"]),e(f,{trigger:"click"},{overlay:t(()=>[e(I,{onClick:k},{default:t(()=>[e(n,{key:"expand"},{default:t(()=>[m(" 展开全部 ")]),_:1}),e(n,{key:"un-expand"},{default:t(()=>[m(" 折叠全部 ")]),_:1})]),_:1})]),default:t(()=>[e(r,{style:{"font-size":"20px",cursor:"pointer"}})]),_:1})]),e(v,{style:{margin:"unset"}}),F("div",Me,[e(_,{expandedKeys:a(l),"onUpdate:expandedKeys":c[1]||(c[1]=u=>N(l)?l.value=u:null),selectedKeys:a(D),"onUpdate:selectedKeys":c[2]||(c[2]=u=>N(D)?D.value=u:null),"tree-data":a(S),fieldNames:{children:"children",title:"name",key:"id"},onSelect:$},null,8,["expandedKeys","selectedKeys","tree-data"])])])}}}),ze={"text-end":""},Pe=z({__name:"SetUserDrawer",props:G({isEdit:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:G(["reload"],["update:open"]),setup(R,{emit:g}){const o=R,w=g,p=ye(R,"open"),k=xe(()=>o.isEdit?"编辑用户":"新增用户"),C=d([]),i=d(),{form:l,resetFormValue:D,setFormValue:S}=de({username:"",nickname:"",deptId:null,phone:"",status:1,sex:1,email:"",role:null}),$=async()=>{await i.value.validate(),V.success("操作成功"),w("reload"),b()},b=()=>{D(),p.value=!1},y=async r=>{const n=await H(r);C.value=J({list:n.data,orderFiled:"order"})},c=d([]),x=async()=>{const r=await re();c.value=r.data};return be(()=>p.value,()=>{var r,n;p.value&&o.isEdit&&S({...o.data,deptId:((n=(r=o.data)==null?void 0:r.dept)==null?void 0:n.id)||null})}),P(()=>{y(),x()}),(r,n)=>{const I=Y,f=Q,v=Ie,_=Ue,u=Re,L=ee,T=te,K=ae,O=B,M=we;return E(),X(M,{open:p.value,"onUpdate:open":n[8]||(n[8]=s=>p.value=s),title:a(k),placement:"right",onClose:b},{footer:t(()=>[F("div",ze,[e(O,{type:"primary",onClick:$},{default:t(()=>[m("确定")]),_:1}),e(O,{onClick:b},{default:t(()=>[m("取消")]),_:1})])]),default:t(()=>[e(K,{ref_key:"formRef",ref:i,model:a(l),layout:"vertical"},{default:t(()=>[e(f,{label:"名称",name:"username",required:""},{default:t(()=>[e(I,{value:a(l).username,"onUpdate:value":n[0]||(n[0]=s=>a(l).username=s),placeholder:"请输入名称",allowClear:""},null,8,["value"])]),_:1}),e(f,{label:"昵称",name:"nickname",required:""},{default:t(()=>[e(I,{value:a(l).nickname,"onUpdate:value":n[1]||(n[1]=s=>a(l).nickname=s),placeholder:"请输入昵称",allowClear:""},null,8,["value"])]),_:1}),e(f,{label:"性别",name:"sex",required:""},{default:t(()=>[e(_,{value:a(l).sex,"onUpdate:value":n[2]||(n[2]=s=>a(l).sex=s),"button-style":"solid"},{default:t(()=>[e(v,{value:1},{default:t(()=>[m("男")]),_:1}),e(v,{value:0},{default:t(()=>[m("女")]),_:1})]),_:1},8,["value"])]),_:1}),e(f,{label:"部门",name:"deptId",required:""},{default:t(()=>[e(u,{value:a(l).deptId,"onUpdate:value":n[3]||(n[3]=s=>a(l).deptId=s),placeholder:"请选择部门","allow-clear":"","tree-data":a(C),"tree-default-expand-all":"","tree-node-filter-prop":"name","field-names":{children:"children",label:"name",value:"id"}},null,8,["value","tree-data"])]),_:1}),e(f,{label:"手机号码",name:"phone",required:""},{default:t(()=>[e(I,{value:a(l).phone,"onUpdate:value":n[4]||(n[4]=s=>a(l).phone=s),placeholder:"请输入手机号码",allowClear:""},null,8,["value"])]),_:1}),e(f,{label:"状态",name:"status",required:""},{default:t(()=>[e(_,{value:a(l).status,"onUpdate:value":n[5]||(n[5]=s=>a(l).status=s),"button-style":"solid"},{default:t(()=>[e(v,{value:1},{default:t(()=>[m("启用")]),_:1}),e(v,{value:0},{default:t(()=>[m("停用")]),_:1})]),_:1},8,["value"])]),_:1}),e(f,{label:"邮箱",name:"email",required:""},{default:t(()=>[e(I,{value:a(l).email,"onUpdate:value":n[6]||(n[6]=s=>a(l).email=s),placeholder:"请输入邮箱",allowClear:""},null,8,["value"])]),_:1}),e(f,{label:"角色",name:"role",required:""},{default:t(()=>[e(T,{value:a(l).role,"onUpdate:value":n[7]||(n[7]=s=>a(l).role=s),placeholder:"请选择角色",allowClear:""},{default:t(()=>[(E(!0),j(Ce,null,he(a(c),s=>(E(),X(L,{key:s.id,value:s.roleCode},{default:t(()=>[m(ke(s.roleName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),je=(R,g)=>[{title:"序号",dataIndex:"index",align:"center",width:60,fixed:"left",customRender:({index:o})=>o+1},{title:"名称",align:"center",dataIndex:"username"},{title:"昵称",align:"center",dataIndex:"nickname"},{title:"性别",align:"center",customRender:({record:o})=>h(Z,{color:o.sex===1?"green":"red"},()=>o.sex===1?"男":"女")},{title:"部门",align:"center",customRender:({record:o})=>o.dept.name},{title:"手机号码",align:"center",dataIndex:"phone"},{title:"状态",align:"center",dataIndex:"status",customRender:({record:o})=>h(Z,{color:o.status===1?"green":"red"},()=>o.status===1?"启用":"停用")},{title:"创建时间",align:"center",dataIndex:"createTime"},{title:"操作",dataIndex:"action",align:"center",width:120,customRender:({record:o})=>h("div",{},[h(B,{type:"link",icon:h(De),onClick:()=>R(o)}),h(W,{type:"vertical"}),h(Se,{title:"确定删除吗？",overlayStyle:{width:"200px"},onConfirm:()=>g(o)},()=>h(B,{type:"link",danger:!0,icon:h(ne)}))])}],Ge={class:"w-full min-h-full flex gap-3"},Xe={class:"w-4/5"},Ze={class:"rounded-1.5 bg-[var(--common-bg-color)] p-4"},Qe=z({__name:"index",setup(R){const g=d(!1),o=d(!1),w=d(),p=A({username:"",status:null}),k=d(!1),C=d(),i=A({pageSize:10,pageNum:1,total:0}),S=je(_=>{k.value=!0,C.value=_,g.value=!0},_=>{V.success("假装删除成功："+_.username),v()}),$=d(),b=d(""),y=_=>{b.value=_,v({...p,dept:b.value,...i})},c=()=>{w.value.resetFields(),r.value=[],i.pageNum=1,i.pageSize=10,i.total=0,v(i)},x=async()=>{v({...p,dept:b.value,...i})},r=d([]),n=d({fixed:!0,selectedRowKeys:r,onChange:_=>{r.value=_}}),I=()=>{k.value=!1,g.value=!0},f=()=>{$e.confirm({title:"提示",icon:e(Ke),content:"请问确认批量删除吗？",closable:!0,onOk(){return Promise.resolve().then(()=>{V.success("假装删除成功"),c()})}})},v=async _=>{o.value=!0;const u=await ie(_);$.value=u.data.rows,i.total=u.data.total,o.value=!1};return P(()=>{v()}),(_,u)=>{const L=Y,T=Q,K=Oe,O=ee,M=te,s=Ee,q=B,le=Fe,oe=Te,se=ae,ue=qe;return E(),j("div",Ge,[e(Ve,{class:"w-1/5",onChange:y}),F("div",Xe,[F("div",Ze,[e(se,{class:"search-form",ref_key:"formRef",ref:w,"label-col":{span:6},model:a(p)},{default:t(()=>[e(oe,{gutter:36},{default:t(()=>[e(K,{span:8},{default:t(()=>[e(T,{label:"用户名称",name:"username"},{default:t(()=>[e(L,{value:a(p).username,"onUpdate:value":u[0]||(u[0]=U=>a(p).username=U),placeholder:"请输入",allowClear:""},null,8,["value"])]),_:1})]),_:1}),e(K,{span:8},{default:t(()=>[e(T,{label:"状态",name:"status"},{default:t(()=>[e(M,{value:a(p).status,"onUpdate:value":u[1]||(u[1]=U=>a(p).status=U),placeholder:"请选择",allowClear:""},{default:t(()=>[e(O,{value:0},{default:t(()=>[m("停用")]),_:1}),e(O,{value:1},{default:t(()=>[m("启用")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(K,{span:8,"text-end":""},{default:t(()=>[e(q,{onClick:c},{icon:t(()=>[e(s)]),default:t(()=>[m(" 重置 ")]),_:1}),e(q,{type:"primary",ghost:"",onClick:x},{icon:t(()=>[e(le)]),default:t(()=>[m(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),e(a(Ne),{class:"mt-3",columns:a(S),"data-source":a($),bordered:"",title:"用户管理",rowKey:"id",loading:a(o),pagination:{current:a(i).pageNum,pageSize:a(i).pageSize,total:a(i).total,showTotal:U=>`共 ${U} 条`},"row-selection":a(n),onReload:c},{"pre-tools":t(()=>[e(q,{type:"primary",onClick:I},{icon:t(()=>[e(ue)]),default:t(()=>[m(" 新增 ")]),_:1}),e(q,{ghost:"",danger:"",disabled:!a(r).length,onClick:f},{icon:t(()=>[e(a(ne))]),default:t(()=>[m(" 批量删除 ")]),_:1},8,["disabled"])]),_:1},8,["columns","data-source","loading","pagination","row-selection"])]),e(Pe,{open:a(g),"onUpdate:open":u[2]||(u[2]=U=>N(g)?g.value=U:null),data:a(C),isEdit:a(k),onReload:u[3]||(u[3]=U=>k.value=!1)},null,8,["open","data","isEdit"])])}}});export{Qe as default};
